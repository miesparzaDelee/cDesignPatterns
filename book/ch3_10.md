## Observer Pattern (Multi-Callback)

### Overview

**1:N notifications**. Multiple listeners register to be notified whenever something changes. Unlike 3.9 (Simple Callback) which fires once on completion, this pattern fires repeatedly on every change during an operation.

**Implementation:** See `companion_code/ch3_patterns/include/canvas.h` and `src/canvas.c`

### Module API

```c
// Canvas module extends 3.9 with position change observer
typedef void (*canvas_positionListener_t)(api_shape_t *shape, 
                                          int16_t x, 
                                          int16_t y, 
                                          void *context);

void canvas_setPositionChangeCallback(canvas_positionListener_t callback, 
                                      void *context);
void canvas_enablePositionListener(void);
void canvas_disablePositionListener(void);
```

### Key Differences from 3.9

**3.9 Simple Callback:**
- Fires **once** when shape arrives at destination
- One-shot completion event

**3.10 Observer Pattern:**
- Fires on **every position change** during movement
- Repeated change-driven events
- Can be enabled/disabled at runtime

### Task Implementation

```c
void canvas_task() {
    for each moving shape:
        update position gradually
        
        // 3.10: Notify on every change
        if (positionListenerEnabled && positionListener != NULL) {
            positionListener(shape, current_x, current_y, context);
        }
        
        // 3.9: Notify on completion
        if (movement_finished && moveCallback != NULL) {
            moveCallback(shape, moveContext);
        }
}
```

### Usage Example

```c
// Track every position change
void positionLogger(api_shape_t *shape, int16_t x, int16_t y, void *ctx) {
    printf("Position: (%d, %d)\n", x, y);
}

canvas_config_t config = {};
config.positionListener = positionLogger;
canvas_init(&config);

canvas_moveShape(shape, 3, 0);
// Triggers 3 position callbacks as shape moves from 0→1→2→3
canvas_task(); canvas_task(); canvas_task(); canvas_task();
```

### Important Notes

- **Repeated notifications** - Every change triggers callback
- **Runtime control** - Can enable/disable listener
- **Same listener for all shapes** - One callback handles everything
- Ideal for:
  - Real-time position logging
  - UI updates during animation
  - Telemetry streaming
  - Progress tracking

**Status:** ✅ Implemented and tested. See canvas module in companion code.
